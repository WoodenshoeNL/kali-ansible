---
# Disable ANY auto-lock on a Kali XFCE VM (idle OR suspend)

#######################################################################
# keep xfce4-screensaver but set every lock bit to false
#######################################################################
- name: XFCE | turn off xfce4-screensaver locking via xfconf
  become_user: "{{ login_user }}"               # run as the desktop user
  shell: |
    dbus-launch xfconf-query -c xfce4-screensaver -p /lock/enabled              -n -t bool -s false
    dbus-launch xfconf-query -c xfce4-screensaver -p /lock/sleep-activation     -n -t bool -s false
    dbus-launch xfconf-query -c xfce4-screensaver -p /saver/idle-activation-enabled -n -t bool -s false
  changed_when: true
  failed_when: false                            # non-fatal if D-Bus unavailable
  when: vmware_env in ["workstation", "laptop"]
  tags:
    - screenlock
    - common

#######################################################################
# stop the daemon so it never starts (comment out if unwanted)
#######################################################################
- name: XFCE | block xfce4-screensaver autostart system-wide
  lineinfile:
    path: /etc/xdg/autostart/xfce4-screensaver.desktop
    regexp: '^Hidden='
    line: 'Hidden=true'
    create: yes
  when: vmware_env in ["workstation", "laptop"]
  tags:
    - screenlock
    - common
